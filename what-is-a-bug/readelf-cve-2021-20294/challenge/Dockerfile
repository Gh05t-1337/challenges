FROM ubuntu:24.04
RUN apt-get update && apt-get install -y cmake build-essential python3-pwntools git flex bison wget
ADD --chown=0:0 --chmod=6755 https://github.com/pwncollege/exec-suid/releases/latest/download/exec-suid /usr/bin/exec-suid
COPY print_sym_table.c crash_to_flag.c /challenge/
RUN <<END
    set -e
    mkdir -p /challenge/bin
    cd /challenge

    wget 'https://ftp.unicamp.br/pub/gnu/binutils/binutils-2.35.tar.gz'
    tar xvf binutils-2.35.tar.gz

    cd binutils-2.35
    ./configure CFLAGS="-O2 -fno-stack-protector -U_FORTIFY_SOURCE" CXXFLAGS="-O2 -fno-stack-protector -U_FORTIFY_SOURCE" LDFLAGS=""
    make
    cp binutils/readelf /challenge/bin/

    cd /challenge
    rm -rf binutils-2.35.tar.gz binutils-2.35

    gcc -o /challenge/print_sym_table /challenge/print_sym_table.c
    chmod 6755 /challenge/print_sym_table
END
