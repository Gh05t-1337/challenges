#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

int main(int argc, char *argv[]) {
    if (argc != 2) {
        fprintf(stderr, "Usage: %s <shell_script.sh>\n", argv[0]);
        return 1;
    }

    const char *filename = argv[1];
    size_t len = strlen(filename);
    
    if (len > 3 && strcmp(filename + len - 3, ".sh") != 0) {
        printf("The file '%s' is NOT a .sh file.\n", filename);
        return 1;
    }

    printf("Running your script: %s\n", filename);
    printf("=====================================\n\n");

    const char *custom_bash = "/opt/bash43/bin/bash";
    setenv("LD_PRELOAD", "/challenge/crash_to_flag.so", 1);
    char *newargv[] = { (char *)custom_bash, (char *)filename, NULL };
    int ret = execv(custom_bash, newargv);
    if (ret == -1) {
        perror("execl failed");
        return 1;
    }

    printf("=====================================\n\n");
    printf("Script ran sucessfully\n");
    return 0;
}