#include <libxml/xmlschemas.h>
#include <libxml/parser.h>
#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <fcntl.h>

int main(int argc, char* argv[]) {
    if (argc < 2) {
        fprintf(stderr, "Usage: %s <schema.xsd>\n", argv[0]);
        return 9001;
    }
    // Make sure we're not doing something dumb like sending in the flag
    int schema_fd = open(argv[1],O_RDONLY);
    char schema_smallbuff[13] = {0};
    read(schema_fd,schema_smallbuff,12);
    if (strncmp(schema_smallbuff,"pwn.college{",12) == 0) {
        printf("NO CHEATING\n");
        close(schema_fd);
        return 1;
    }
    close(schema_fd);
    // Load the crafted schema
    xmlSchemaParserCtxtPtr ctxt = xmlSchemaNewParserCtxt(argv[1]);
    xmlSchemaPtr schema = xmlSchemaParse(ctxt);

    // Free resources, if we got this far
    xmlSchemaFree(schema);
    xmlSchemaFreeParserCtxt(ctxt);
    return 0;
}
