FROM ubuntu:24.04

ADD --chown=0:0 --chmod=6755 http://github.com/pwncollege/exec-suid/releases/latest/download/exec-suid /usr/bin/exec-suid

RUN apt-get update && apt-get install -yq \
    cmake build-essential python3-pwntools git flex bison wget tar \
    libssl-dev unzip autoconf automake libtool

ARG DEBIAN_FRONTEND=noninteractive
ARG SUDO_TAG=SUDO_1_8_31
ENV SUDO_PREFIX=/challenge/sudo-vuln

RUN set -e && \
    mkdir -p /challenge/bin && \
    mkdir -p ${SUDO_PREFIX} && \
    mkdir -p ${SUDO_PREFIX}/etc && \
    cd /challenge && \
    git clone https://github.com/sudo-project/sudo.git && \
    git config --global user.email "mo.saied075@gmail.com" && \
    git config --global user.name "Mohamed Sayed (FlEx)" && \
    cd sudo && \
    git checkout ${SUDO_TAG} && \
    ./configure \
        --prefix="${SUDO_PREFIX}" \
        --sysconfdir="${SUDO_PREFIX}/etc" \
        --disable-root-mailer \
        --disable-setresuid \
        --with-rundir=/tmp \
        --with-vardir=/tmp && \
    make && \
    make install INSTALL_OWNER="" &&\
    cp /challenge/sudo-vuln/bin/* /challenge/bin/

RUN useradd -m -s /bin/bash flex
